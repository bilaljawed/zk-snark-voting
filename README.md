# zk-Voting with Hardhat and snarkjs

This repository contains a decentralized voting application that uses zero-knowledge proofs (zk-SNARKs) for vote validation. The zk-SNARK proof is generated off chain using [snarkjs](https://github.com/iden3/snarkjs) and verified on chain using Solidity smart contracts deployed with Hardhat.

## Prerequisites

-   [Node.js](https://nodejs.org/) (v14 or later)
-   [Hardhat](https://hardhat.org/)
-   [snarkjs](https://github.com/iden3/snarkjs) (install globally or locally)
-   [Circom](https://docs.circom.io/) (for compiling the circuits)

## Setup

1. **Clone the repository:**

    ```bash
    git clone https://github.com/bilaljawed/zk-snark-voting.git
    cd zk-voting
    ```

2. **Install dependencies:**

    ```bash
    npm install
    ```

3. **Compile the smart contracts:**

    ```bash
    npx hardhat compile
    ```

4. **Compile the circuit (if modifying or generating new proofs):**

    ```bash
    circom circuits/vote.circom --r1cs --wasm --sym -o circuits/
    # Generate the zkey and verification key using snarkjs:
    snarkjs groth16 setup circuits/vote.r1cs pot12_final.ptau circuits/vote_0000.zkey
    snarkjs zkey contribute circuits/vote_0000.zkey circuits/vote_final.zkey --name="Contributor Name" -v
    snarkjs zkey export verificationkey circuits/vote_final.zkey circuits/verification_key.json
    ```

5. **Deploy the contracts:**
    ```bash
    npx hardhat run scripts/deploy.js --network localhost
    ```

## Testing

Run the tests with Hardhat:

```bash
npx hardhat test
```

## How It Works

-   **Zero-Knowledge Circuit:**  
    The `circuits/vote.circom` file defines a simple circuit that enforces a binary vote (0 or 1). This ensures that only valid votes are considered.

-   **Proof Generation:**  
    Off chain, you use `snarkjs` to generate a zk-SNARK proof from the compiled circuit. The proof (and public inputs) are then passed to the voting contract.

-   **On-Chain Verification:**  
    The `Verifier.sol` contract (typically generated by snarkjs) verifies the zk-SNARK proof. The `Voting.sol` contract calls this verifier to allow a vote only if the proof is valid and the public input (candidate ID) matches the vote.

-   **Voting Logic:**  
    Each voter can cast a vote only once. A valid vote increases the candidate’s vote count, and the voter’s address is recorded to prevent double voting.
